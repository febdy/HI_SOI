<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cs">

	<select id="selectPage" parameterType="map" resultType="com.bit.hi.domain.vo.CsVo">
		<![CDATA[
			select rn,
       				noti_no notiNo,
        			noti_title notiTitle,
        			noti_content notiContent,
        			to_char(noti_date, 'YYYY-MM-DD HH:MI') notiDate,
        			noti_hit_cnt notiHitCnt,
        			user_id userId,
        			user_level userLevel
			from (select ROWNUM rn,
                				noti_no,
                    			noti_title,
                    			noti_content,
                    			noti_date,
                    			noti_hit_cnt,
                    			user_id,
                    			user_level
        			from (select noti_no,
                    			noti_title,
                    			noti_content,
                    			noti_date,
                    			noti_hit_cnt,
                    			us.user_id,
                    			us.user_level
                			from notice noti, users us
                			where noti.user_id=us.user_id
                			]]> <!-- jstl이 아니라는 것을 알려주기 위한 것 -->
                			<if test="kwd!=null and kwd!=''">
                				and noti_title like '%'||#{kwd}||'%'
                			</if>
                			<![CDATA[
                			order by noti_no desc) o) t
			where rn > #{startRnum}
			and rn <= #{endRnum}
		]]> <!-- 세미콜론 지우는 것 꼭 확인 -->
	</select> <!-- 페이징을 다 한뒤, 검색기능을 쿼리문에 추가해준다. -->
	<!-- if문을 써주어, kwd와 동일한지 -->
	
	<select id="totalCount" parameterType="String" resultType="int">
		<![CDATA[
			select count(*)
			from notice
		]]> <!-- jstl이 아니라는 것을 알려주기 위한 것 -->
        	<if test="_parameter!=null and _parameter!=''">
                where noti_title like '%'||#{_parameter}||'%'
            </if> <!-- int면 like다음에  '%'||${kwd}||'%' 와도 되지만, String 하나이므로, kwd를 _parameter로 바꿔준다. -->
       <![CDATA[
		]]> <!-- kwd가 있을때는 그것만 가지고 카운트를 할 수 있도록 해야함. -->
	</select>
	
	<!-- 공지 글쓰기 -->
	<insert id="insertNoticeWrite" parameterType="com.bit.hi.domain.vo.CsVo">
		<![CDATA[
			insert into notice
			values (seq_notice_no.nextval, #{notiTitle}, #{notiContent}, sysdate, 0, #{userId})
		]]>
	</insert>
	
	<select id="selectEachNotice" parameterType="int" resultType="com.bit.hi.domain.vo.CsVo">
		<![CDATA[
			select noti_no notiNo,
					noti_title notiTitle,
					noti_content notiContent,
					noti_date notiDate,
					noti_hit_cnt notiHitCnt,
					user_id userId
			from notice
			where noti_no=#{notiNo}
		]]>
	</select>

	<select id="selectNoticeForModify" parameterType="int" resultType="com.bit.hi.domain.vo.CsVo">
		<![CDATA[
			select noti_no notiNo,
					noti_title notiTitle,
					noti_content notiContent,
					noti_date notiDate,
					noti_hit_cnt notiHitCnt,
					user_id userId
			from notice
			where noti_no=#{notiNo}
		]]>
	</select>
	
	<update id="updateEachNotice" parameterType="com.bit.hi.domain.vo.CsVo">
		<![CDATA[
			update notice
			set noti_title=#{notiTitle}, noti_content=#{notiContent}
			where noti_no=#{notiNo}
		]]>
	</update>
	
	<update id="updateHitEachNotice" parameterType="int">
		<![CDATA[
			update notice
			set noti_hit_cnt=noti_hit_cnt+1
			where noti_no=#{notiNo}
		]]>
	</update>
</mapper>